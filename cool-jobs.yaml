- job: test_${{ parameters.agent_os }}
  displayName: "Test ${{ parameters.agent_os }}"
  pool:
    name: ${{ parameters.test_pool }}
    demands: Agent.OS -equals ${{ parameters.agent_os }}
  steps:
    - ${{ each node_version in parameters.node_versions }}:
      - ${{ each node_arch in parameters.node_arch_${{ parameters.agent_os }}:
        - template: setup-nodejs.yaml
          parameters:
            node_version: ${{ node_version }}
            node_arch: ${{ node_arch }}
        - bash: |
            node -e "console.log(process.version+\" arch:\"+process.arch)"
        - template: do-something-else.yaml
